var mainState=function(){var troopsColors=[],troopsNames=[],Icons=[],YuanNums=[];this.init=function(){$.ajax({type:"POST",url:c.data.url+"Desai_TeamService.ashx?pagetype=TeamInfo",async:!1,data:{uID:c.data.uID,iD:c.data.iD},success:function(data){var data=eval("("+data+")").data;data.forEach(function(a){troopsNames.push(a.Name),troopsColors.push(a.Color),Icons.push(a.ID),YuanNums.push(a.TeamEnergy)},this)}})},this.create=function(){function a(a){null==c.data.DesaiTeamID?$.ajax({type:"POST",url:c.data.url+"WXClientService.ashx?pagetype=update2",data:{uID:c.data.uID,openID:c.data.wxID,desaiTeamID:Number(a.id),desaiTeamName:a.name},success:function(a){game.state.add("select",selectState),game.state.start("select")}}):c.data.DesaiTeamID!=a.id?c.hint("您选择的队伍为\n"+c.data.DesaiTeamName+"!"):(game.state.add("select",selectState),game.state.start("select"))}var e,t,n,r,d=225,i=320,o=["d1YuanBg","d2YuanBg","d3YuanBg","d4YuanBg","d5YuanBg","d6YuanBg","d7YuanBg","d8YuanBg"],s=["d1Yuan","d2Yuan","d3Yuan","d4Yuan","d5Yuan","d6Yuan","d7Yuan","d8Yuan"];e=game.add.image(0,0,"tpl_module"),c.Title("队伍方阵");var g=game.add.image(0,0,"tpl_module"),l=game.add.image(114,244,"gameRule"),m=c.Title("游戏规则");c.close(function(){l.destroy(),g.destroy(),m.destroy();for(var e=0;e<8;e++){var u=Icons[e],h=s[e],f=o[e],p=troopsNames[e],v=YuanNums[e],x=troopsColors[e];if(e%2==0){var y=i+230*e/2,D=game.add.button(d-45,i-45+230*e/2,"icon"+u,a);D.name=p,D.id=u,f=c.Arc(d,y,360,"0xaaaaaa"),h=c.Arc(d,y,3.6*v,"0x"+x),game.add.text(d,y+100,p,{fill:"#000",font:"25px Arial",align:"center"}).anchor.set(.5),game.add.text(d,y+130,v+"%",{fill:"#"+x,font:"25px Arial",align:"center"}).anchor.set(.5)}else{var y=i+230*(e-1)/2,I=game.width-d,D=game.add.button(I-45,i-45+230*(e-1)/2,"icon"+u,a);D.name=p,D.id=u,f=c.Arc(I,y,360,"0xaaaaaa"),h=c.Arc(I,y,3.6*v,"0x"+x),game.add.text(I,y+100,p,{fill:"#000",font:"25px Arial",align:"center"}).anchor.set(.5),game.add.text(I,y+130,v+"%",{fill:"#"+x,font:"25px Arial",align:"center"}).anchor.set(.5)}}t=game.add.button(game.world.centerX,150,"line1",function(){g=game.add.image(0,0,"tpl_module"),l=game.add.image(114,244,"gameRule"),m=c.Title("游戏规则"),c.close(function(){l.destroy(),g.destroy(),m.destroy()})}),t.anchor.set(.5),n=game.add.text(game.world.centerX,153,"活动规则",{fill:"#000",font:"30px Arial",align:"center"}),n.anchor.set(.5),r=null==c.data.DesaiTeamID?game.add.text(game.world.centerX,210,"点击选择你支持的队伍，为他们添加火炬能量",{fill:"#000",font:"20px Arial",align:"center"}):game.add.text(game.world.centerX,210,"您已选择\t"+c.data.DesaiTeamName+"\t的队伍，为他们添加火炬能量",{fill:"#000",font:"20px Arial",align:"center"}),r.anchor.set(.5)})}},selectState=function(){this.create=function(){function a(a){var e=c.data.userGameLimit[a.id-1].PlayTime;return e>4?void c.hint("该项目次数以达上限\n请参加别的项目!"):(c.data.GameType=a.id,game.state.add("GameState",GameState),void game.state.start("GameState"))}var e,t;e=game.add.image(0,0,"tpl_module"),t=game.add.image(0,0,"selectGame"),c.Click(175,901,"个人榜","line1",function(){openTopWay="gameBegin",rankingID="个人",game.state.add("Top",TopState),game.state.start("Top")}),c.Click(175,981,"团队榜","line1",function(){openTopWay="gameBegin",rankingID="队伍",game.state.add("Top",TopState),game.state.start("Top")}),game.add.text(game.world.centerX,game.world.height-90,"已经\t\t\t\t\t\t\t\t\t\t参加活动，快来参加吧",{fill:"#000",font:"25px Arial",align:"center"}).anchor.set(.5),game.add.text(game.world.centerX-100,game.world.height-90,c.data.memberInfo,{fill:"#f00",font:"25px Arial",align:"center"}).anchor.set(.5),c.Title("运动模式");var n=game.add.button(202,147,"click",a),r=game.add.button(483,272,"click",a),d=game.add.button(309,495,"click",a),i=game.add.button(99,703,"click",a);n.scale.set(22,23),r.scale.set(20,22),d.scale.set(25,20),i.scale.set(30,26),n.id=1,r.id=2,d.id=3,i.id=4}},GameState=function(){this.init=function(){$.ajax({type:"POST",url:c.data.url+"Desai_SportsModeService.ashx?pagetype=SportsModeInfo",async:!1,data:{uID:c.data.uID},success:function(data){var data=eval("("+data+")").data;c.data.CoreNumber=data.CoreNumber,c.data.EnergyHighest=data.EnergyHighest}})},this.create=function(){function a(){var a;s=game.add.text(game.world.centerX,game.world.centerY,"0",{fill:"#fff",font:"130px Arial",align:"center"}),s.y=248.5,s.anchor.set(.5),a=game.add.text(0,731,I+"s",{fill:"#000",font:"40px Arial",align:"center"}),a.x=game.world.centerX,a.anchor.set(.5),p=setInterval(function(){if(I--,a.text=I+"s",0==I)return c.data.userScore=s.text,setTimeout(function(){game.state.add("score",scoreState),game.state.start("score");var a;a=c.data.userScore*c.data.CoreNumber>c.data.EnergyHighest?c.data.EnergyHighest:c.data.userScore*c.data.CoreNumber,$.ajax({type:"POST",url:c.data.url+"Desai_RecordService.ashx?pagetype=add2",async:!1,data:{uID:c.data.uID,openID:c.data.wxID,sportsModeID:c.data.GameType,sportsModeName:c.data.userGameLimit[c.data.GameType-1].SportsModeName,score:a},success:function(a){}})},2e3),void clearInterval(p)},1e3)}function e(a,e){return a=game.add.image(0,0,e),a.anchor.set(.5),a.x=game.world.centerX,a.y=a.height/2+50,a}function t(){function a(a){var d=a.accelerationIncludingGravity,c=(new Date).getTime();if(c-last_update>100){var i=c-last_update;last_update=c,x=d.x,y=d.y,z=d.z;var g=Math.abs(x+y+z-last_x-last_y-last_z)/i*1e4;g>e&&D&&(o.x-=t,o.width+=t,u.x-=t,r.x-=t,r.width+=t,n++,n%10==0&&(navigator.vibrate?navigator.vibrate(1e3):navigator.webkitVibrate&&navigator.webkitVibrate(1e3)),s.text=n),last_x=x,last_y=y,last_z=z}}var e=2e3,t=20,n=last_update=x=y=z=last_x=last_y=last_z=0,r=game.add.tileSprite(game.world.width,260,1,373,"paodao");r.bottom=game.height,window.DeviceMotionEvent?window.addEventListener("devicemotion",a,!1):alert("not support mobile event"),setTimeout(function(){window.removeEventListener("devicemotion",a,!1)},1e3*I)}function n(){function a(a){r&&(d-=a.touches.length,n.height+=.7*a.touches.length,s.text=d,r=!1)}var e,t,n,r,d=0;t=game.add.image(198,842,"qq_energy"),n=game.add.image(198,842,"qq_energyBg"),n.scale.set(70,25),game.add.image(0,0,"game22").bottom=game.height,e=game.add.image(266,954,"click"),e.scale.set(22),e.inputEnabled=!0,e.events.onInputUp.add(function(){if(D){if(r=!0,d++,s.text=d,n.height<0)return void(n.height=0);n.height-=.7}},this),document.addEventListener("touchend",a,!1),setTimeout(function(){e.destroy(),document.removeEventListener("touchend",a,!1)},1e3*I+3e3)}function r(){u.destroy();var a;game.add.image(0,0,"game33").bottom=game.height,a=game.add.image(game.world.centerX,0,"langan"),a.anchor.set(.5),a.bottom=game.height,game.add.tween(a).to({y:a.y+a.height-200},1e3*I,"Linear",!0),game.add.tween(a.scale).to({x:1.5,y:1.5},1e3*I,"Linear",!0),i("y")}function d(){var a=game.add.tileSprite(0,0,10,u.height-1,"ty_line");a.x=game.world.width,a.bottom=game.world.height,i("x",a)}function i(a,e){function t(a){turnX=o=c=a.touches[0].pageX,turnY=g=i=a.touches[0].pageY,h=f=a.touches[0].pageX,p=v=a.touches[0].pageY}function n(t){r=t.touches[0].pageX,d=t.touches[0].pageY,l=r-c,m=d-i,x=Math.floor(Math.abs(180*Math.atan2(m,l)/Math.PI)),"x"==a?c>=r?(w[0]=!0,f=r,o=h):(w[1]=!0,h=r,o=f):"y"==a&&(i>=d?(w[0]=!0,p=d,g=v):(w[1]=!0,v=d,g=p)),"x"==a?(y=Math.floor(document.documentElement.clientWidth/8),(x>130||x<45||0==x)&&(c=r,i=d,(o-y>=r||o+y<=r)&&w[0]&&w[1]&&D&&(T++,s.text=T,e.width+=2,e.x-=2,u.x-=2,w[0]=w[1]=!1))):"y"==a&&(y=Math.floor(document.documentElement.clientHeight/7),(x<130&&x>45||0==x)&&(c=r,i=d,(g-y>=d||g+y<=d)&&w[0]&&w[1]&&D&&(T++,s.text=T,w[0]=w[1]=!1)))}var r,d,c,i,o,g,l,m,h,f,p,v,x,y,T=0,w=[];document.addEventListener("touchmove",n,!1),document.addEventListener("touchstart",t,!1),setTimeout(function(){document.removeEventListener("touchmove",n,!1),document.removeEventListener("touchstart",t,!1)},1e3*I+3e3)}var o,s,g,l,m,u,h,f,p,v,D,I=30,T=3;switch(o=game.add.tileSprite(0,0,750,1206,"game_bg"),c.data.GameType){case 1:var w="game4",S="左右滑动手机30秒\n滑出你的能量",m="hand4";break;case 2:var w="game3",S="上下滑动手机30秒\n滑出你的能量",m="hand3";break;case 3:var w="game2",S="狂戳圆心30秒\n戳出你的能量",m="hand2";break;case 4:var w="game1",S="拿起手机摇30秒\n摇出你的能量",m="hand1"}e(g,"circle"),h=e(h,"circle_text"),h.inputEnabled=!0;var b=game.add.sprite(game.world.centerX,game.world.centerY-100,m);if(b.anchor.set(.5),b.scale.set(.3),b.animations.add(m,[0,1,2,3]),b.animations.play(m,3,!0),l=game.add.text(game.world.centerX,game.world.centerY,S,{fill:"#000",font:"25px Arial",align:"center"}),l.anchor.set(.5),v=game.add.button(34,220,"return",function(){clearInterval(f),clearInterval(p),game.state.add("select",selectState),game.state.start("select")}),u=game.add.image(0,0,w),u.bottom=game.height,3==c.data.GameType)var k=game.add.button(0,0,"qianqiuHint",function(){k.destroy(),h.events.onInputUp.add(function(){h.destroy(),h=e(h,"circle_"+T),T--,n(),f=setInterval(function(){return 0==T?(a(),clearInterval(f),h.destroy(),void(D=!0)):(h.destroy(),h=e(h,"circle_"+T),void T--)},1e3)})});else h.events.onInputUp.add(function(){switch(h.destroy(),h=e(h,"circle_"+T),T--,f=setInterval(function(){return 0==T?(a(),clearInterval(f),h.destroy(),void(D=!0)):(h.destroy(),h=e(h,"circle_"+T),void T--)},1e3),c.data.GameType){case 1:d();break;case 2:r();break;case 3:n();break;case 4:t()}})}},scoreState=function(){var userScore;this.init=function(){userScore=c.data.userScore*c.data.CoreNumber>c.data.EnergyHighest?c.data.EnergyHighest:c.data.userScore*c.data.CoreNumber},this.create=function(){var torch,scoreImg,scoreText,p;game.add.image(0,0,"game_bg"),torch=c.AddTorch(260,1),torch.y=torch.y+60,scoreImg=game.add.image(game.world.centerX,184,"score"),scoreText=game.add.text(game.world.centerX,184,userScore,{fill:"#fff",font:"140px Arial",align:"center"}),p=game.add.text(game.world.centerX,914,"你本次为德赛西威运动会火炬添加\t\t\t\t\t\t\t\t\t个能量",{fill:"#000",font:"25px Arial",align:"center"}),c.Click(-140,1050,"排行榜","line2",function(){openTopWay="gameEnd",rankingID="个人",game.state.add("Top",TopState),game.state.start("Top")}),c.Click(140,1050,"继续游戏","line2",function(){$.ajax({type:"POST",url:c.data.url+"Desai_RecordService.ashx?pagetype=playInfo",async:!1,data:{uID:c.data.uID,id:c.data.iD,openID:c.data.wxID},success:function(data){var data=eval("("+data+")");c.data.userGameLimit=data.data}}),game.state.add("select",selectState),game.state.start("select")}),p.anchor.set(.5),game.add.text(523,915,userScore,{fill:"#f00",font:"25px Arial",align:"center"}).anchor.set(.5),scoreImg.anchor.set(.5),scoreText.anchor.set(.5),scoreImg.scale.set(1,.9)}},TopState=function(){var userData,troopsData,userTopData;this.init=function(){"队伍"!=rankingID&&"个人"!=rankingID||$.ajax({type:"POST",url:c.data.url+"WXClientService.ashx?pagetype=rankInfo",async:!1,data:{uID:c.data.uID,openID:c.data.wxID},success:function(data){var data=eval("("+data+")").data;c.data.userPic=data.Pic,c.data.userDesaiScore=data.DesaiScore,c.data.userScoreRank=data.ScoreRank,c.data.userURL=data.URL}}),"个人"==rankingID?$.ajax({type:"POST",url:c.data.url+"WXClientService.ashx?pagetype=rankInfo2",async:!1,data:{uID:c.data.uID},success:function(data){var data=eval("("+data+")").data;userTopData=data}}):"队伍"==rankingID&&$.ajax({type:"POST",url:c.data.url+"Desai_TeamService.ashx?pagetype=rankInfo",async:!1,data:{uID:c.data.uID},success:function(data){var data=eval("("+data+")").data,arr=[],arrData=[];data.forEach(function(a){arr.push(parseInt(a.TeamEnergy))},this),arr.sort(function(a,e){return e-a});for(var i=0;i<arr.length;i++)for(var j=0;j<data.length;j++){var e=data[j];parseInt(e.TeamEnergy)==arr[i]&&arrData.push(e)}troopsData=arrData}})},this.preload=function(){if("队伍"!=rankingID&&"个人"!=rankingID||game.load.image("userPic",c.data.userPic),"个人"==rankingID)for(var a=0;a<userTopData.length;a++){var e=userTopData[a];game.load.image("userPic"+(a+1),e.Pic)}},this.create=function(){function a(a){for(var e="",t=0;t<a.length;t++)32==a.charCodeAt(t)&&(e+=String.fromCharCode(12288)),a.charCodeAt(t)<127&&(e+=String.fromCharCode(a.charCodeAt(t)+65248));return e}function e(){var a=game.add.button(0,0,"shareHint",function(){a.destroy()})}game.add.image(0,0,"tpl_module"),c.Title("能量榜"),game.add.image(game.world.centerX,310,"line3").anchor.set(.5);for(var t=game.add.graphics(0,0),n=game.add.graphics(0,0),r=game.add.image(94,161,"userPic"),d=c.data.wxName+"，感谢你为德赛西威第七届田径运动会火炬添加"+c.data.userDesaiScore+"个能量，在小伙伴排名第"+c.data.userScoreRank+"位。",i="",o=d.indexOf("名第")+2,s=d.length-2,g=d.indexOf("添加")+2,l=d.indexOf("个能量"),m=0;m<d.length;m++){var u=d[m];m%16==0&&m>0&&(i+="\n"),Number(u)&&(t_String=u+"",u=a(t_String)),i+=u}var h=game.add.text(230,161,i,{fill:"#000",font:"25px Arial"});if(h.addColor("#f00",g),h.addColor("#000",l),h.addColor("#f00",o),h.addColor("#000",s),t.beginFill(16711680),t.drawRoundedRect(92,159,124,124,20),n.beginFill(0),n.drawRoundedRect(92,159,124,124,15),r.width=120,r.height=120,r.mask=t,"个人"==rankingID){for(var m=0;m<userTopData.length;m++){var f=userTopData[m],p=70*m,v=game.add.graphics(0,0),x=game.add.graphics(0,0),y=game.add.graphics(0,0),D=game.add.graphics(0,0),I=m+1;I<4&&(I=""),game.add.text(104,380+p,I,{fill:"#000",font:"35px Arial",align:"center"}).anchor.set(.5);var T=game.add.image(137,352+p,"userPic"+(m+1));T.width=55,T.height=55,D.beginFill(0),D.drawCircle(163,377+p,48),T.mask=D,v.beginFill(0),v.drawRoundedRect(213,350+p,442,55,10),x.beginFill(13421772),x.drawRoundedRect(208,345+p,320,65,10),y.beginFill(1256577),y.drawRoundedRect(518,345+p,140,65,10),x.mask=v,y.mask=v,game.add.text(588,380+p,f.TeamEnergy,{fill:"#fff",font:"30px Arial",align:"center"}).anchor.set(.5),game.add.text(370,380+p,f.Name,{fill:"#000",font:"25px Arial",align:"center"}).anchor.set(.5)}game.add.image(86,348,"top1").scale.set(.5),game.add.image(88,427,"top2").scale.set(.5),game.add.image(90,496,"top3").scale.set(.5)}if("队伍"==rankingID)for(var m=0;m<troopsData.length;m++){var f=troopsData[m],p=84*m,v=game.add.graphics(0,0),x=game.add.graphics(0,0),y=game.add.graphics(0,0);game.add.text(94,358+p,m+1,{fill:"#000",font:"35px Arial",align:"center"}),game.add.image(132,347+p,"icon"+f.Pic).scale.set(.7),v.beginFill(0),v.drawRoundedRect(213,350+p,442,55,10),x.beginFill(13421772),x.drawRoundedRect(208,345+p,320,65,10),y.beginFill("0x"+f.Color),y.drawRoundedRect(518,345+p,140,65,10),x.mask=v,y.mask=v,game.add.text(588,380+p,f.TeamEnergy,{fill:"#fff",font:"30px Arial",align:"center"}).anchor.set(.5),game.add.text(370,380+p,f.Name,{fill:"#000",font:"25px Arial",align:"center"}).anchor.set(.5)}c.close(function(){"gameEnd"===openTopWay?(game.state.add("score",scoreState),game.state.start("score")):(game.state.add("select",selectState),game.state.start("select"))}),c.Click(-140,1100,"邀请好友","line2",function(){e()}),c.Click(140,1100,"朋友圈嘚瑟","line2",function(){e()})}};