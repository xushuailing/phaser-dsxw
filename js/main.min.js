var mainState=function(){var troopsColors=[],troopsNames=[],Icons=[],YuanNums=[];this.init=function(){$.ajax({type:"POST",url:c.data.url+"Desai_TeamService.ashx?pagetype=TeamInfo",async:!1,data:{uID:c.data.uID,iD:c.data.iD},success:function(data){var data=eval("("+data+")").data;data.forEach(function(a){troopsNames.push(a.Name),troopsColors.push(a.Color),Icons.push(a.ID),YuanNums.push(a.TeamEnergy)},this)}})},this.create=function(){function a(a){null==c.data.DesaiTeamID?$.ajax({type:"POST",url:c.data.url+"WXClientService.ashx?pagetype=update2",data:{uID:c.data.uID,openID:c.data.wxID,desaiTeamID:Number(a.id),desaiTeamName:a.name},success:function(a){game.state.add("select",selectState),game.state.start("select")}}):c.data.DesaiTeamID!=a.id?c.hint("您选择的队伍为\n"+c.data.DesaiTeamName+"!"):(game.state.add("select",selectState),game.state.start("select"))}var e,t,n,r,d=225,o=320,i=["d1YuanBg","d2YuanBg","d3YuanBg","d4YuanBg","d5YuanBg","d6YuanBg","d7YuanBg","d8YuanBg"],s=["d1Yuan","d2Yuan","d3Yuan","d4Yuan","d5Yuan","d6Yuan","d7Yuan","d8Yuan"];e=game.add.image(0,0,"tpl_module"),c.Title("队伍方阵");var l=game.add.image(0,0,"tpl_module"),m=game.add.image(114,244,"gameRule"),g=c.Title("游戏规则");c.close(function(){m.destroy(),l.destroy(),g.destroy();for(var e=0;e<8;e++){var u=Icons[e],h=s[e],f=i[e],p=troopsNames[e],v=YuanNums[e],x=troopsColors[e];if(e%2==0){var y=o+230*e/2,D=game.add.button(d-45,o-45+230*e/2,"icon"+u,a);D.name=p,D.id=u,f=c.Arc(d,y,360,"0xaaaaaa"),h=c.Arc(d,y,3.6*v,"0x"+x),game.add.text(d,y+100,p,{fill:"#000",font:"25px Arial",align:"center"}).anchor.set(.5),game.add.text(d,y+130,v+"%",{fill:"#"+x,font:"25px Arial",align:"center"}).anchor.set(.5)}else{var y=o+230*(e-1)/2,I=game.width-d,D=game.add.button(I-45,o-45+230*(e-1)/2,"icon"+u,a);D.name=p,D.id=u,f=c.Arc(I,y,360,"0xaaaaaa"),h=c.Arc(I,y,3.6*v,"0x"+x),game.add.text(I,y+100,p,{fill:"#000",font:"25px Arial",align:"center"}).anchor.set(.5),game.add.text(I,y+130,v+"%",{fill:"#"+x,font:"25px Arial",align:"center"}).anchor.set(.5)}}t=game.add.button(game.world.centerX,150,"line1",function(){l=game.add.image(0,0,"tpl_module"),m=game.add.image(114,244,"gameRule"),g=c.Title("游戏规则"),c.close(function(){m.destroy(),l.destroy(),g.destroy()})}),t.anchor.set(.5),n=game.add.text(game.world.centerX,153,"活动规则",{fill:"#000",font:"30px Arial",align:"center"}),n.anchor.set(.5),r=null==c.data.DesaiTeamID?game.add.text(game.world.centerX,210,"点击选择你支持的队伍，为他们添加火炬能量",{fill:"#000",font:"20px Arial",align:"center"}):game.add.text(game.world.centerX,210,"您已选择\t"+c.data.DesaiTeamName+"\t的队伍，为他们添加火炬能量",{fill:"#000",font:"20px Arial",align:"center"}),r.anchor.set(.5)})}},selectState=function(){this.init=function(){c.data.isShareUrl&&$.ajax({type:"POST",url:c.data.url+"WXClientService.ashx?pagetype=update2",async:!1,data:{uID:c.data.uID,openID:c.data.wxID,desaiTeamID:c.data.DesaiTeamID,desaiTeamName:c.data.DesaiTeamName},success:function(a){console.log(a)}})},this.create=function(){function a(){t=game.add.image(0,0,"tpl_module"),n=game.add.image(0,0,"selectGame"),c.Click(175,981,"排行榜","line1",function(){openTopWay="gameBegin",game.state.add("Top",TopState),game.state.start("Top")}),game.add.text(game.world.centerX,game.world.height-90,"已经\t\t\t\t\t\t\t\t\t\t参加活动，快来参加吧",{fill:"#000",font:"25px Arial",align:"center"}).anchor.set(.5),game.add.text(game.world.centerX-100,game.world.height-90,c.data.memberInfo,{fill:"#f00",font:"25px Arial",align:"center"}).anchor.set(.5),c.Title("运动模式");var a=game.add.button(202,147,"click",e),r=game.add.button(483,272,"click",e),d=game.add.button(309,495,"click",e),o=game.add.button(99,703,"click",e);a.scale.set(22,23),r.scale.set(20,22),d.scale.set(25,20),o.scale.set(30,26),a.id=1,r.id=2,d.id=3,o.id=4}function e(a){var e=c.data.userGameLimit[a.id-1].PlayTime;return e>4?void c.hint("该项目次数以达上限\n请参加别的项目!"):(c.data.GameType=a.id,game.state.add("GameState",GameState),void game.state.start("GameState"))}var t,n;if(c.data.isShareUrl){var r=game.add.image(0,0,"tpl_module"),d=game.add.image(114,244,"gameRule"),o=c.Title("游戏规则");c.close(function(){d.destroy(),r.destroy(),o.destroy(),a()})}else a()}},GameState=function(){this.init=function(){$.ajax({type:"POST",url:c.data.url+"Desai_SportsModeService.ashx?pagetype=SportsModeInfo",async:!1,data:{uID:c.data.uID},success:function(data){var data=eval("("+data+")").data;c.data.CoreNumber=data.CoreNumber,c.data.EnergyHighest=data.EnergyHighest}})},this.create=function(){function a(){var a;s=game.add.text(game.world.centerX,game.world.centerY,"0",{fill:"#fff",font:"130px Arial",align:"center"}),s.y=248.5,s.anchor.set(.5),a=game.add.text(0,731,I+"s",{fill:"#000",font:"40px Arial",align:"center"}),a.x=game.world.centerX,a.anchor.set(.5),p=setInterval(function(){if(I--,a.text=I+"s",0==I)return c.data.userScore=s.text,setTimeout(function(){game.state.add("score",scoreState),game.state.start("score");var a;a=c.data.userScore*c.data.CoreNumber>c.data.EnergyHighest?c.data.EnergyHighest:c.data.userScore*c.data.CoreNumber,$.ajax({type:"POST",url:c.data.url+"Desai_RecordService.ashx?pagetype=add2",async:!1,data:{uID:c.data.uID,openID:c.data.wxID,sportsModeID:c.data.GameType,sportsModeName:c.data.userGameLimit[c.data.GameType-1].SportsModeName,score:a},success:function(a){}})},2e3),void clearInterval(p)},1e3)}function e(a,e){return a=game.add.image(0,0,e),a.anchor.set(.5),a.x=game.world.centerX,a.y=a.height/2+50,a}function t(){function a(a){var d=a.accelerationIncludingGravity,c=(new Date).getTime();if(c-last_update>100){var o=c-last_update;last_update=c,x=d.x,y=d.y,z=d.z;var l=Math.abs(x+y+z-last_x-last_y-last_z)/o*1e4;l>e&&D&&(i.x-=t,i.width+=t,u.x-=t,r.x-=t,r.width+=t,n++,n%10==0&&(navigator.vibrate?navigator.vibrate(1e3):navigator.webkitVibrate&&navigator.webkitVibrate(1e3)),s.text=n),last_x=x,last_y=y,last_z=z}}var e=2e3,t=20,n=last_update=x=y=z=last_x=last_y=last_z=0,r=game.add.tileSprite(game.world.width,260,1,373,"paodao");r.bottom=game.height,window.DeviceMotionEvent?window.addEventListener("devicemotion",a,!1):alert("not support mobile event"),setTimeout(function(){window.removeEventListener("devicemotion",a,!1)},1e3*I)}function n(){function a(a){r&&(d-=a.touches.length,n.height+=.7*a.touches.length,s.text=d,r=!1)}var e,t,n,r,d=0;t=game.add.image(198,842,"qq_energy"),n=game.add.image(198,842,"qq_energyBg"),n.scale.set(70,25),game.add.image(0,0,"game22").bottom=game.height,e=game.add.image(266,954,"click"),e.scale.set(22),e.inputEnabled=!0,e.events.onInputUp.add(function(){if(D){if(r=!0,d++,s.text=d,n.height<0)return void(n.height=0);n.height-=.7}},this),document.addEventListener("touchend",a,!1),setTimeout(function(){e.destroy(),document.removeEventListener("touchend",a,!1)},1e3*I+3e3)}function r(){u.destroy();var a;game.add.image(0,0,"game33").bottom=game.height,a=game.add.image(game.world.centerX,0,"langan"),a.anchor.set(.5),a.bottom=game.height,game.add.tween(a).to({y:a.y+a.height-200},1e3*I,"Linear",!0),game.add.tween(a.scale).to({x:1.5,y:1.5},1e3*I,"Linear",!0),o("y")}function d(){var a=game.add.tileSprite(0,0,10,u.height-1,"ty_line");a.x=game.world.width,a.bottom=game.world.height,o("x",a)}function o(a,e){function t(a){turnX=i=c=a.touches[0].pageX,turnY=l=o=a.touches[0].pageY,h=f=a.touches[0].pageX,p=v=a.touches[0].pageY}function n(t){r=t.touches[0].pageX,d=t.touches[0].pageY,m=r-c,g=d-o,x=Math.floor(Math.abs(180*Math.atan2(g,m)/Math.PI)),"x"==a?c>=r?(T[0]=!0,f=r,i=h):(T[1]=!0,h=r,i=f):"y"==a&&(o>=d?(T[0]=!0,p=d,l=v):(T[1]=!0,v=d,l=p)),"x"==a?(y=Math.floor(document.documentElement.clientWidth/8),(x>130||x<45||0==x)&&(c=r,o=d,(i-y>=r||i+y<=r)&&T[0]&&T[1]&&D&&(S++,s.text=S,e.width+=2,e.x-=2,u.x-=2,T[0]=T[1]=!1))):"y"==a&&(y=Math.floor(document.documentElement.clientHeight/7),(x<130&&x>45||0==x)&&(c=r,o=d,(l-y>=d||l+y<=d)&&T[0]&&T[1]&&D&&(S++,s.text=S,T[0]=T[1]=!1)))}var r,d,c,o,i,l,m,g,h,f,p,v,x,y,S=0,T=[];document.addEventListener("touchmove",n,!1),document.addEventListener("touchstart",t,!1),setTimeout(function(){document.removeEventListener("touchmove",n,!1),document.removeEventListener("touchstart",t,!1)},1e3*I+3e3)}var i,s,l,m,g,u,h,f,p,v,D,I=30,S=3;switch(i=game.add.tileSprite(0,0,750,1206,"game_bg"),c.data.GameType){case 1:var T="game4",w="左右滑动手机30秒\n滑出你的能量",g="hand4";break;case 2:var T="game3",w="上下滑动手机30秒\n滑出你的能量",g="hand3";break;case 3:var T="game2",w="狂戳圆心30秒\n戳出你的能量",g="hand2";break;case 4:var T="game1",w="拿起手机摇30秒\n摇出你的能量",g="hand1"}e(l,"circle"),h=e(h,"circle_text"),h.inputEnabled=!0;var b=game.add.sprite(game.world.centerX,game.world.centerY-100,g);if(b.anchor.set(.5),b.scale.set(.3),b.animations.add(g,[0,1,2,3]),b.animations.play(g,3,!0),m=game.add.text(game.world.centerX,game.world.centerY,w,{fill:"#000",font:"25px Arial",align:"center"}),m.anchor.set(.5),v=game.add.button(34,220,"return",function(){clearInterval(f),clearInterval(p),game.state.add("select",selectState),game.state.start("select")}),u=game.add.image(0,0,T),u.bottom=game.height,3==c.data.GameType)var _=game.add.button(0,0,"qianqiuHint",function(){_.destroy(),h.events.onInputUp.add(function(){h.destroy(),h=e(h,"circle_"+S),S--,n(),f=setInterval(function(){return 0==S?(a(),clearInterval(f),h.destroy(),void(D=!0)):(h.destroy(),h=e(h,"circle_"+S),void S--)},1e3)})});else h.events.onInputUp.add(function(){switch(h.destroy(),h=e(h,"circle_"+S),S--,f=setInterval(function(){return 0==S?(a(),clearInterval(f),h.destroy(),void(D=!0)):(h.destroy(),h=e(h,"circle_"+S),void S--)},1e3),c.data.GameType){case 1:d();break;case 2:r();break;case 3:n();break;case 4:t()}})}},scoreState=function(){var userScore;this.init=function(){userScore=c.data.userScore*c.data.CoreNumber>c.data.EnergyHighest?c.data.EnergyHighest:c.data.userScore*c.data.CoreNumber},this.create=function(){var torch,scoreImg,scoreText,p;game.add.image(0,0,"game_bg"),torch=c.AddTorch(260,1),torch.y=torch.y+60,scoreImg=game.add.image(game.world.centerX,184,"score"),scoreText=game.add.text(game.world.centerX,184,userScore,{fill:"#fff",font:"140px Arial",align:"center"}),p=game.add.text(game.world.centerX,914,"你本次为德赛西威运动会火炬添加\t\t\t\t\t\t\t\t\t个能量",{fill:"#000",font:"25px Arial",align:"center"}),c.Click(-140,1050,"排行榜","line2",function(){openTopWay="gameEnd",game.state.add("Top",TopState),game.state.start("Top")}),c.Click(140,1050,"继续游戏","line2",function(){$.ajax({type:"POST",url:c.data.url+"Desai_RecordService.ashx?pagetype=playInfo",async:!1,data:{uID:c.data.uID,id:c.data.iD,openID:c.data.wxID},success:function(data){var data=eval("("+data+")");c.data.userGameLimit=data.data}}),game.state.add("select",selectState),game.state.start("select")}),p.anchor.set(.5),game.add.text(513,915,userScore,{fill:"#f00",font:"25px Arial",align:"center"}).anchor.set(.5),scoreImg.anchor.set(.5),scoreText.anchor.set(.5),scoreImg.scale.set(1,.9)}},TopState=function(){var userData,troopsData;this.init=function(){$.ajax({type:"POST",url:c.data.url+"Desai_TeamService.ashx?pagetype=rankInfo",async:!1,data:{uID:c.data.uID},success:function(data){var data=eval("("+data+")").data,arr=[],arrData=[];data.forEach(function(a){arr.push(parseInt(a.TeamEnergy))},this),arr.sort(function(a,e){return e-a});for(var i=0;i<arr.length;i++)for(var j=0;j<data.length;j++){var e=data[j];parseInt(e.TeamEnergy)==arr[i]&&arrData.push(e)}troopsData=arrData}}),$.ajax({type:"POST",url:c.data.url+"WXClientService.ashx?pagetype=rankInfo",async:!1,data:{uID:c.data.uID,openID:c.data.wxID},success:function(data){var data=eval("("+data+")").data;c.data.userPic=data.Pic,c.data.userDesaiScore=data.DesaiScore,c.data.userScoreRank=data.ScoreRank,c.data.userURL=data.URL}})},this.preload=function(){game.load.image("userPic",c.data.userPic)},this.create=function(){function a(a){for(var e="",t=0;t<a.length;t++)32==a.charCodeAt(t)&&(e+=String.fromCharCode(12288)),a.charCodeAt(t)<127&&(e+=String.fromCharCode(a.charCodeAt(t)+65248));return e}function e(){var a=game.add.button(0,0,"shareHint",function(){a.destroy()})}var t=(game.add.image(0,0,"tpl_module"),game.add.image(game.world.centerX,310,"line3"));t.anchor.set(.5);c.Title("运动达人榜");for(var n=game.add.graphics(0,0),r=game.add.graphics(0,0),d=game.add.image(94,161,"userPic"),o=c.data.wxName+"，感谢你为德赛西威第七届田径运动会火炬添加"+c.data.userDesaiScore+"个能量，在小伙伴排名第"+c.data.userScoreRank+"位。",i="",s=o.indexOf("名第")+2,l=o.length-2,m=o.indexOf("添加")+2,g=o.indexOf("个能量"),u=0;u<o.length;u++){var h=o[u];u%16==0&&u>0&&(i+="\n"),Number(h)&&(t_String=h+"",h=a(t_String)),i+=h}var f=game.add.text(230,161,i,{fill:"#000",font:"25px Arial"});f.addColor("#f00",m),f.addColor("#000",g),f.addColor("#f00",s),f.addColor("#000",l),n.beginFill(16711680),n.drawRoundedRect(92,159,124,124,20),r.beginFill(0),r.drawRoundedRect(92,159,124,124,15),d.width=120,d.height=120,d.mask=n;for(var u=0;u<troopsData.length;u++){var p=troopsData[u],v=84*u,x=game.add.graphics(0,0),y=game.add.graphics(0,0),D=game.add.graphics(0,0);game.add.text(94,358+v,u+1,{fill:"#000",font:"35px Arial",align:"center"}),game.add.image(132,347+v,"icon"+p.Pic).scale.set(.7),x.beginFill(0),x.drawRoundedRect(213,350+v,442,55,10),y.beginFill(13421772),y.drawRoundedRect(208,345+v,320,65,10),D.beginFill("0x"+p.Color),D.drawRoundedRect(518,345+v,140,65,10),y.mask=x,D.mask=x,game.add.text(588,380+v,p.TeamEnergy,{fill:"#fff",font:"30px Arial",align:"center"}).anchor.set(.5),game.add.text(370,380+v,p.Name,{fill:"#000",font:"25px Arial",align:"center"}).anchor.set(.5)}c.Click(-140,1100,"邀请好友","line2",function(){e()}),c.Click(140,1100,"朋友圈嘚瑟","line2",function(){e()}),c.close(function(){"gameEnd"===openTopWay?(game.state.add("score",scoreState),game.state.start("score")):(game.state.add("select",selectState),game.state.start("select"))})}};